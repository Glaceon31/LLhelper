<!DOCTYPE html>
<html>
   <head>
      <title>LLhelper</title>
      <link href="http://libs.baidu.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">
   <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
   <script src="http://libs.baidu.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
   <script type="text/javascript" src="{{ url_for('static', filename='twintailosu.js') }}?v=1.01"></script>
   <link rel="shortcut icon" href="/static/shortcuticon.png" />
   <style type="text/css">
   	button {position:relative;height:200px;width:200px;margin-left:100px;margin-top:100px;background-color:#F0F8FF}
   	img {height:65px;width:65px}
   </style>
   <script>
   var regS = new RegExp("&#34;", "g")
   var regS2 = new RegExp("&#39;", "g")
   var regSand = new RegExp("&amp;", "g")
   var defaultsong = new Array()
   defaultsong["name"] = "默认曲目（缪）"
   defaultsong["jpname"] = "默认曲目（缪）"
   defaultsong["muse"] = 1
   defaultsong["aqours"] = 0
   defaultsong['attribute'] = 'smile'
   var defaultsong2 = new Array()
   defaultsong2["name"] = "默认曲目（水）"
   defaultsong2["jpname"] = "默认曲目（水）"
   defaultsong2["muse"] = 0
   defaultsong2["aqours"] = 1
   defaultsong2['attribute'] = 'smile'
   expert_default = new Array()
   expert_default["positionweight"] = [63.75,63.75,63.75,63.75,0,63.75,63.75,63.75,63.75]
   expert_default["combo"] = 500
   expert_default["time"] = 110
   expert_default["star"] = 65
   master_default = new Array()
   master_default["positionweight"] = [87.5,87.5,87.5,87.5,0,87.5,87.5,87.5,87.5]
   master_default["combo"] = 700
   master_default["time"] = 110
   master_default["star"] = 65
   defaultsong["expert"] = expert_default
   defaultsong["master"] = master_default
   defaultsong["type"] = "0"
   defaultsong2["expert"] = expert_default
   defaultsong2["master"] = master_default
   defaultsong2["type"] = "0"
   var cardsjson = "{{cardsjson}}".replace(regS,'"').replace(regS2, "'").replace(regSand, '&')
   var songsjson = "{{songsjson}}".replace(regS,'"').replace(regS2, "'").replace(regSand, '&')
   var cards = eval("("+cardsjson+")")
   var songs = eval("("+songsjson+")")
   songs["00"] = defaultsong
   songs["01"] = defaultsong2
   var attcolor = new Array();
   var mezame = 0
   var language = 0
   attcolor["smile"] = "red"
   attcolor["pure"] = "green"
   attcolor["cool"] = "blue"
   var kizuna = new Array();
   kizuna["N"] = [25, 50]
   kizuna["R"] = [100, 200]
   kizuna["SR"] = [250, 500]
   kizuna["SSR"] = [375, 750]
   kizuna["UR"] = [500, 1000]
   nametojp = new Array()
   nametojp["高坂穗乃果"] = "高坂穂乃果"
   nametojp["绚濑绘里"] = "絢瀬絵里"
   nametojp["南小鸟"] = "南ことり"
   nametojp["园田海未"] = "園田海未"
   nametojp["星空凛"] = "星空凛"
   nametojp["西木野真姬"] = "西木野真姫"
   nametojp["东条希"] = "東條希"
   nametojp["小泉花阳"] = "小泉花陽"
   nametojp["矢泽妮可"] = "矢澤にこ"
   nametojp["高海千歌"] = "高海千歌"
   nametojp["樱内梨子"] = "桜内梨子"
   nametojp["松浦果南"] = "松浦果南"
   nametojp["黑泽黛雅"] = "黒澤ダイヤ"
   nametojp["渡边曜"] = "渡辺曜"
   nametojp["津岛善子"] = "津島善子"
   nametojp["国木田花丸"] = "国木田花丸"
   nametojp["小原鞠莉"] = "小原鞠莉"
   nametojp["黑泽露比"] = "黒澤ルビィ"
   unitgradechr = [[],
                  ["星空凛","西木野真姫","小泉花陽","津島善子","国木田花丸","黒澤ルビィ"],
                  ["高坂穂乃果","南ことり","園田海未","高海千歌","桜内梨子","渡辺曜"],
                  ["絢瀬絵里","東條希","矢澤にこ","松浦果南","黒澤ダイヤ","小原鞠莉"],
                  ["高坂穂乃果","絢瀬絵里","南ことり","園田海未","星空凛","西木野真姫","東條希","小泉花陽","矢澤にこ"],
                  ["高海千歌","桜内梨子","松浦果南","黒澤ダイヤ","渡辺曜","津島善子","国木田花丸","小原鞠莉","黒澤ルビィ"],
                  ["高坂穂乃果","南ことり","小泉花陽"],
                  ["園田海未","星空凛","東條希"],
                  ["絢瀬絵里","西木野真姫","矢澤にこ"],
                  ["高海千歌","渡辺曜","黒澤ルビィ"],
                  ["松浦果南","黒澤ダイヤ","国木田花丸"],
                  ["桜内梨子","津島善子","小原鞠莉"]]


   var member = ['','1年生','2年生','3年生',"μ's",'Aqours','Printemps','lilywhite','BiBi','CYaRon!','AZALEA','Guilty Kiss']
   
   var skilllevel = 0
	attr = new Array();//↓成员属性值*0
	HN = new Array();//每张卡的槽数//↓z0
	grade = new Array();//↓每个成员的年级*
	Match_c = new Array(0,0,0,0,0,0,0,0,0);//是否满足副c
	skillP = new Array();//z
	skind = new Array();//z0
	var Precal;
	comb=[];
	arms=new Array();//√
	P_up=new Array();//每个成员的对应宝石贡献属性增值
	P_sum = 0;
	Sum_Max_Mem=0;
	MPM=new Array();
	Team_Method=[];
	Current_MP=0;
	IsPrecalced=false;
	gradecount=new Array();
	skillcount=new Array();
	SNum = new Array();//↓每种宝石的数量*z0
   
function threetonumber(three){
      result = three
      if (result[0] == '0'){
         result = result[1]+result[2]
      }
      if (result[0] == '0'){
         result = result[1]
      }
      return result
   }

   function lvlup(){
      skilllevel += 1
      if (skilllevel == 8)
         skilllevel = 0
      changeskilllevel()
   }

   function lvldown(){
      skilllevel -= 1
      if (skilllevel == -1)
         skilllevel = 7
      changeskilllevel()
   }

   function isinunitgroup(unitgrade, character){
      if (unitgrade == 0)
         return true
      for (i in unitgradechr[unitgrade]){
         if (unitgradechr[unitgrade][i] == character)
            return true
      }
      return false
   }

   function changeskilllevel(){
      document.getElementById('skilllevel').innerHTML = String(skilllevel+1)
      index = document.getElementById('cardchoice').value
      /*
      if (cards[index].skill){
         document.getElementById('require').innerHTML = cards[index]['skilldetail'][skilllevel].require
         document.getElementById('possibility').innerHTML = cards[index]['skilldetail'][skilllevel].possibility
         document.getElementById('score').innerHTML = cards[index]['skilldetail'][skilllevel].score
      }*/
   }

   naipan = 480
   function changenaipan(){
      if (!document.getElementById('naipan').checked)
         naipan = 480
      else
         naipan = 270
      //changecolor('cardchoice')
   }

   pos = -1
   function changepos(i){
      if (pos==-1){
         document.getElementById('pos'+String(i)).value = '选择' 
         pos = i
      }
      else{
         document.getElementById('pos'+String(pos)).value = '换位'+String(pos+1)
         swaplist = ['cardid','mezame','main','smile','pure','cool','skilllevel','gemnum','gemsinglepercent','gemallpercent','gemskill','gemacc']
         for (j in swaplist){
            at = swaplist[j]
            tmp = document.getElementById(at+String(pos)).value
            document.getElementById(at+String(pos)).value = document.getElementById(at+String(i)).value
            document.getElementById(at+String(i)).value = tmp
         } 
         changeavatar(pos)
         changeavatar(i)
         pos = -1 
      }
   }

   function changeunitskilllevel(n){
      index = document.getElementById('cardid'+String(n)).value
      level = parseInt(document.getElementById('skilllevel'+String(n)).value)-1
      if ((level < 0) || (level > 7)) return
      document.getElementById('require'+String(n)).value = cards[index]['skilldetail'][level].require
      document.getElementById('possibility'+String(n)).value = cards[index]['skilldetail'][level].possibility
      document.getElementById('score'+String(n)).value = cards[index]['skilldetail'][level].score
   }

   function getskilllevel(n){

      score = document.getElementById('score'+String(n)).value
      index = threetonumber(document.getElementById('cardid'+String(n)).value)
      if (!cards[index].skill) return 0
      for (i=0;i<8;i++){
         if (cards[index]['skilldetail'][i].score == score)
            return i+1
      }
      return 0
   }

   function cardtoskilltype(c){
      if (!c)
         return 0
      if (!c.skill)
         return 0
      if ((c.skilleffect == 4) || (c.skilleffect == 5)){
         if (c.triggertype == 1)
            return 5
         else if (c.triggertype == 3)
            return 6
         else if (c.triggertype == 4)
            return 12
      }
      else if (c.skilleffect == 9){
         if (c.triggertype == 1)
            return 8
         else if (c.triggertype == 3)
            return 7
         else if (c.triggertype == 4)
            return 13
         else if (c.triggertype == 6)
            return 9
      }
      else if (c.skilleffect == 11){
         if (c.triggertype == 1)
            return 4
         else if (c.triggertype == 3)
            return 1
         else if (c.triggertype == 4)
            return 11
         else if (c.triggertype == 5)
            return 3
         else if (c.triggertype == 6)
            return 2
         else if (c.triggertype == 12)
            return 10
      }
   }

   function getcardselect(rarity, chr, att, cardtype,special){
      sel = document.getElementById("cardchoice");
      skilltype = document.getElementById("skilltype").value
      triggertype = document.getElementById("triggertype").value
      setname = document.getElementById("setname").value
      unitgrade = document.getElementById("unitgrade").value
      sel.options.length = 1;
      var index = 1;
      //alert(chr)
      for (card in cards){
         if (!cards[index]) continue
         if (((rarity == "") || (rarity == cards[index].rarity)) && ((chr == "") || (cards[index].jpname.indexOf(nametojp[chr]) != -1)) && ((att == "") || (att == cards[index].attribute)) && ((special == "") || ((cards[index].special == 0) && (special == 0)) || ((cards[index].special == 1) && (special == 1))) && ((cardtype == "") || (cards[index].type.indexOf(cardtype) != -1)) && ((skilltype == "") || (skilltype == cards[index].skilleffect)) && ((triggertype == "") || (triggertype == cards[index].triggertype)) && ((setname == "") || (setname == cards[index].jpseries))){
            if ((!(document.getElementById('showncard').checked) && (cards[index].rarity == 'N')) || (cards[index].support == 1)){
               index += 1
               continue
            }
            if (!isinunitgroup(unitgrade, cards[index].jpname)){
               index += 1
               continue
            }
            var newOption
            if (cards[index].eponym) {eponym = "【"+cards[index].eponym+"】"} else eponym = ""
            if (cards[index].series && (cards[index].series != '')) {series = "("+cards[index].series+")"} else series = ""
            if (cards[index].jpeponym) {jpeponym = "【"+cards[index].jpeponym+"】"} else jpeponym = ""
            if (cards[index].jpseries && (cards[index].jpseries != '')) {jpseries = "("+cards[index].jpseries+")"} else jpseries = ""
            if (language == 0)
               newOption = new Option(tothree(cards[index].id)+" "+cards[index].rarity+" "+eponym+cards[index].name+" "+series, index)
            else
               newOption = new Option(tothree(cards[index].id)+" "+cards[index].rarity+" "+jpeponym+cards[index].jpname+" "+jpseries, index)
            newOption.style.color = attcolor[cards[index].attribute]
            sel.options.add(newOption)
         }
         index += 1
      }
      //changecolor("cardchoice")
   }
   
   function getsongselect(att){
      sel = document.getElementById("songchoice");
      var keyword = document.getElementById("songsearch").value
      sel.options.length = 1;
      newOption = new Option(songs["00"].name, "00")
      newOption.style.color = attcolor[songs["00"].attribute]
      sel.options.add(newOption)
      newOption = new Option(songs["01"].name, "01")
      newOption.style.color = attcolor[songs["01"].attribute]
      sel.options.add(newOption)
      for (index in songs){
         if (((att == "") || (att == songs[index].attribute))){
         if ((keyword == "") || (songs[index].name.toLowerCase().indexOf(keyword.toLowerCase()) != -1) || (songs[index].jpname.toLowerCase().indexOf(keyword.toLowerCase()) != -1) || (songs[index].type != "0")){
            mfhave = false
            //alert(smhave)
               var newOption
               if (language == 0)
                  newOption = new Option(songs[index].name, index)
               else
                  newOption = new Option(songs[index].jpname, index)
               newOption.style.color = attcolor[songs[index].attribute]
               sel.options.add(newOption)

         }
         }
         index += 1
      }
      //changesongcolor("songchoice")
   }
   
   function havevalue(selectId, value){
   	objSelect = document.getElementById(selectId)
   	for (var i = 0; i < objSelect.options.length; i++){
   		if (objSelect.options[i].value == value)
   			return true;
   	}
   	return false;
   }
   
   function changesongselect(){
   	att = document.getElementById("songatt").value
   	var songchoice = document.getElementById("songchoice").value
   	getsongselect(att)
   	if (havevalue("songchoice", songchoice)){
   		document.getElementById("songchoice").value = songchoice
   	}
   	changesongcolor("songchoice")
   }
   
   function changecardselect(){
      rarity = document.getElementById("rarity").value
      chr = document.getElementById("chr").value
      att = document.getElementById("att").value
      cardtype = document.getElementById("cardtype").value
      special = document.getElementById("special").value
      var cardchoice = document.getElementById("cardchoice").value
      getcardselect(rarity, chr, att, cardtype, special)
      if (havevalue("cardchoice", cardchoice)){
         document.getElementById("cardchoice").value = cardchoice
      }
      changecolor("cardchoice")
   }
   
   function changecolor(which){

   	index = document.getElementById(which).value
   	if (index != "") {
   		c = attcolor[cards[index].attribute]
   		document.getElementById(which).style.color = c
   		document.getElementById("main").value = cards[index].attribute
   		
         //document.getElementById('skill').value = cardtoskilltype(cards[index])
         if (cards[index].skill){
            //skilllevel = parseInt(document.getElementById('skilllevel').innerHTML)
            document.getElementById('require').innerHTML = cards[index]['skilldetail'][skilllevel].require
            document.getElementById('possibility').innerHTML = cards[index]['skilldetail'][skilllevel].possibility
            document.getElementById('score').innerHTML = cards[index]['skilldetail'][skilllevel].score
         }
   		infolist2 = ["smile", "pure", "cool"]
   		if (mezame == 0){
   			for (i in infolist2){
   				document.getElementById(infolist2[i]).value = cards[index][infolist2[i]]
   				document.getElementById("mezame").value = "未觉醒"
   			}
   		}
   		else{
   			for (i in infolist2){
   				document.getElementById(infolist2[i]).value = cards[index][infolist2[i]+"2"]
   				document.getElementById("mezame").value = "已觉醒"
   			}
   		}
   		document.getElementById("kizuna").value = kizuna[cards[index].rarity][mezame]
   		changeskilltext("")
   	}
   	changeavatarselect()
   }
   
   function changesongcolor(which){
   	index = document.getElementById(which).value
      diff = document.getElementById('diffchoice').value
   	if (index != "") {
   		c = attcolor[songs[index].attribute]
   		document.getElementById(which).style.color = c
         document.getElementById("secondbase").innerHTML = songs[index].attribute
         document.getElementById("secondbase2").innerHTML = songs[index].attribute
   		selectlist = ["map", "bonus", "bonus2"]
   		for (i in selectlist){
   			document.getElementById(selectlist[i]).value = songs[index].attribute
   		}
   		if (document.getElementById("percentage").value != 12)
   			document.getElementById("base").value = songs[index].attribute
   		if (document.getElementById("percentage2").value != 12)
   			document.getElementById("base2").value = songs[index].attribute
   		infolist = ["combo",  "time"]
   		for (i in infolist){
   			document.getElementById(infolist[i]).value = songs[index][diff][infolist[i]]
   		}
         if (document.getElementById("time").value == ""){
            document.getElementById("time").value = 110
         }
         totalweight = 0
         for (i = 0; i < 9; i++)
            totalweight += parseFloat(songs[index][diff]['positionweight'][i])
         c = parseInt(songs[index][diff].combo)
         sl = (totalweight-c)*100/0.25/c
         //document.getElementById('slider').value = sl.toFixed(1)
   		document.getElementById("perfect").value = parseInt(parseInt(document.getElementById("combo").value)*19/20)
   		document.getElementById("starperfect").value = 0//parseInt(parseInt(document.getElementById("star").value)*19/20)
   		for (i = 0; i < 9; i++){
   			document.getElementById("weight"+String(i)).value = parseFloat(songs[index][diff]["positionweight"][i])
   		}
   	}
   }
   
   function cardidtoindex(n){
   	cardid = parseInt(n)
   	for (i in cards){
   		if (cards[i].id == n){
   			return i
   		}
   	}
   }
   
   function calslot(n){
      result = 0
      result += parseInt(parseInt(document.getElementById("gemnum"+String(n)).value)/200)
      result +=  parseInt(parseFloat(document.getElementById("gemsinglepercent"+String(n)).value)/0.05)
      result +=  parseInt(parseFloat(document.getElementById("gemallpercent"+String(n)).value)/0.0059)
      result += parseInt(parseInt(document.getElementById("gemskill"+String(n)).value)*4)
      result += parseInt(parseInt(document.getElementById("gemacc"+String(n)).value)*4)
      document.getElementById("slot"+String(n)).innerHTML = result
   }

   function copyTo(n){
   	copyList = ["main", "smile", "pure", "cool"]
   	for (i in copyList){
         if (copyList[i] == document.getElementById("main").value)
            document.getElementById(copyList[i]+String(n)).value = parseInt(document.getElementById(copyList[i]).value)+parseInt(document.getElementById("kizuna").value)
         else
   		document.getElementById(copyList[i]+String(n)).value = document.getElementById(copyList[i]).value
   	}
      document.getElementById("skilllevel"+String(n)).value = document.getElementById('skilllevel').innerHTML
   	document.getElementById("mezame"+String(n)).value = mezame
   	document.getElementById("cardid"+String(n)).value = cards[String(document.getElementById("cardchoice").value)].id
   	//changeskilltext(n)
   	if (n == 4){
   		changecenter()
   	}
   	changeavatar(n)
   }
   
   function changecenter(){
   	cardid = parseInt(document.getElementById("cardid4").value)
   	index = 0
   	for (i in cards){
   		if (cards[i].id == cardid){
   			index = i
   			break
   		}
   	}
   	document.getElementById("bonus").value = cards[index]["attribute"]
   	document.getElementById("percentage").value = cards[index]["Cskillpercentage"]
   	document.getElementById("base").value = cards[index]["Cskillattribute"]
      document.getElementById("secondpercentage").value = "0"
      if (cards[index]["rarity"] == "SSR" || cards[index]["rarity"] == "UR"){
         document.getElementById("secondlimit").value = cards[index]["Csecondskilllimit"]
         //document.getElementById("secondbase").innerHTML = cards[index]["attribute"]
         document.getElementById("secondpercentage").value = cards[index]["Csecondskillattribute"]
      }
   }
   
   function tothree(string){
   	str = String(string)
   	while (str.length < 3){
   		str = '0'+str
   	}
   	return str
   }
   
   function carddata(cardid){
      for (index = 0; index < cards.length; index++){
         if (cards[index]['id'] == cardid)
            return cards[index]
      }
      return ''
   }

   function changeavatar(n){
   	cardid = threetonumber(document.getElementById('cardid'+String(n)).value)
   	if ((cardid == 0) || (cardid == "") || (cardid == "0"))
   		document.getElementById('avatar'+String(n)).src = '/static/null.png'
   	else if (document.getElementById('mezame'+String(n)).value == 0)
         document.getElementById('avatar'+String(n)).src = getimagepath(cards[cardid]['id'],'avatar',0)
   	else
   		document.getElementById('avatar'+String(n)).src = getimagepath(cards[cardid]['id'],'avatar',1)
   }
   
   function changeavatarselect(){
   	document.getElementById('imageselect').src = '/static/null.png'
   	cardid = 0
   	if (document.getElementById('cardchoice').value != '')
   		cardid = cards[document.getElementById('cardchoice').value].id
   	if ((cardid == 0) || (cardid == "") || (cardid == "0"))
   		document.getElementById('imageselect').src = '/static/null.png'
   	else if (mezame == 0)
   		document.getElementById('imageselect').src = getimagepath(cards[document.getElementById('cardchoice').value]['id'],'avatar',0)
   	else
   		document.getElementById('imageselect').src = getimagepath(cards[document.getElementById('cardchoice').value]['id'],'avatar',1)
   }
   
   function changeLanguage(){
   	var cardchoice = document.getElementById("cardchoice").value
   	var songchoice = document.getElementById("songchoice").value
   	language = 1-language
   	changecardselect()
   	changesongselect()
   	document.getElementById("cardchoice").value = cardchoice
   	document.getElementById("songchoice").value = songchoice
   }
   
   function changeskilltext(n){
   	var postfix = ""
   	if ((n != "") || (String(n) == "0")) 
   		postfix = String(n)
      var skilltype = cardtoskilltype(cards[document.getElementById("cardchoice").value])
   	//var skilltype = document.getElementById("skill"+postfix).value
   	//if (skilltype == 0)
   	//	document.getElementById("skilltext"+postfix).style.display = "none"
   	//else 
   	//	document.getElementById("skilltext"+postfix).style.display = ""
   	//require
   	if ((skilltype == 1) || (skilltype == 6) || (skilltype == 7))
   		document.getElementById("requiretext"+postfix).innerHTML = "个图标"
   	else if ((skilltype == 2) || (skilltype == 9))
   		document.getElementById("requiretext"+postfix).innerHTML = "个perfect"
   	else if (skilltype == 3)
   		document.getElementById("requiretext"+postfix).innerHTML = "分"
   	else if (skilltype == 10)
   		document.getElementById("requiretext"+postfix).innerHTML = "星星perfect"
   	else if ((skilltype == 4) || (skilltype == 5) || (skilltype == 8))
   		document.getElementById("requiretext"+postfix).innerHTML = "秒"
   	else if ((skilltype == 11) || (skilltype == 12) || (skilltype == 13))
   		document.getElementById("requiretext"+postfix).innerHTML = "combo"
   	//effect
   	if ((skilltype == 1) || (skilltype == 2) || (skilltype == 3) || (skilltype == 4) || (skilltype == 10) || (skilltype == 11)){
   		document.getElementById("effecttext"+postfix).innerHTML = "增加"
   		document.getElementById("unittext"+postfix).innerHTML = "分"
   	}
   	if ((skilltype == 5) || (skilltype == 6) || (skilltype == 12)){
   		document.getElementById("effecttext"+postfix).innerHTML = "增强判定"
   		document.getElementById("unittext"+postfix).innerHTML = "秒"
   	}
   	if ((skilltype == 7) || (skilltype == 8) || (skilltype == 9) || (skilltype == 13)){
   		document.getElementById("effecttext"+postfix).innerHTML = "回复"
   		document.getElementById("unittext"+postfix).innerHTML = "点体力"
   	}
   }
   
   function toMezame(){
   	mezame = 1-mezame
   	changecolor("cardchoice")
   	changeavatarselect()
   }
   
   


   function clearall(){
   	var inputs = document.getElementsByTagName("input");
   	var selects = document.getElementsByTagName("select");
   	for (var i=0; i<inputs.length; i++){
   		setCookie(inputs[i].name+"unit", inputs[i].value, -1);
   	}
   	for (var i=0; i<selects.length; i++){
   		setCookie(selects[i].name+"unit", selects[i].value, -1);
   	}
   	setCookie("mezame"+"unit", mezame, -1)
   	window.location.href="/llnewunit"
   }
   
   function saveunit(){
   	member = [{}, {}, {},{},{},{},{},{},{}]
   	saveatt = ['smile', 'pure', 'cool', 'skilllevel', 'cardid', 'mezame', 'gemnum', 'gemsinglepercent', 'gemallpercent', 'gemskill', 'gemacc']
   	for (i=0;i<9;i++){
   		for (j in saveatt){
   			member[i][saveatt[j]] = document.getElementById(saveatt[j]+String(i)).value
   		}
   	}
   	unitjson = JSON.stringify(member)
   	window.location.href="/llsaveunit/"+unitjson
   }
   
   var tmponsubmit
   function loadunit(){
   	document.getElementById("unitform").action = '/llloadnewunit'
   	tmponsubmit = document.getElementById("unitform").onsubmit
   	document.getElementById("unitform").onsubmit = ''
   	document.getElementById("unitform").target = 'if'
   }
   
   function precalcu(){
   	document.getElementById("unitform").action = ''
   	document.getElementById("unitform").onsubmit = tmponsubmit
   	document.getElementById("unitform").target = ''
   }
   
   function init(){
   	//document.getElementById('avatar0').src = 'http://i2.tietuku.com/8baa9a87cc083022.jpg'
      skilllevel = 0
   	mezame = getCookie("mezameunit")
   	language = getCookie("languageunit")
   	if (mezame == "")
   		mezame = 0
   	if (language == "")
   		language = 0
   	
   	getcardselect("", "", "", "", "", "");
   	getsongselect("", "", "", "");
   	var inputs = document.getElementsByTagName("input");
   	var selects = document.getElementsByTagName("select");
   	for (var i=0; i<inputs.length; i++){
   		if (inputs[i].type == "text")
   			if (getCookie(inputs[i].name+"unit") != "")
   				inputs[i].value = getCookie(inputs[i].name+"unit");
   	}
   	for (var i=0; i<selects.length; i++){
   		if (getCookie(selects[i].name+"unit") != "")
   			selects[i].value = getCookie(selects[i].name+"unit");
   	}
   	if (mezame == 1)
   		document.getElementById("mezame").checked = mezame
   	//selects["cardchoice"].value = getCookie(selects["cardchoice"].name);
   	//selects["songchoice"].value = getCookie(selects["songchoice"].name);
   	changeskilltext("")
      changeskilllevel()
   	changeavatarselect()
   	for (i = 0; i < 9; i++){
   		//changeskilltext(i)
   		changeavatar(i)
         calslot(i)
   	}
   	document.getElementById("songsearch").value = ""
   	//changecolor("cardchoice")
   	//changesongcolor("songchoice")
   	document.getElementById("songchoice").style.color = attcolor[songs[document.getElementById("songchoice").value].attribute]
   	document.getElementById("cardchoice").style.color = attcolor[cards[document.getElementById("cardchoice").value].attribute]
   }
   
   function changediffinfo(){
      savediff = document.getElementById('diffchoice').value
      index = document.getElementById('songchoice').value

      diffsel = document.getElementById('diffchoice')
      diffsel.options.length = 0;
      diffname = ['easy', 'normal', 'hard', 'expert','master']
      finddiff = false
      for (i in diffname){
         diff = diffname[i]
         if (songs[index][diff] != null){

                  newOption = new Option(diff, diff)
                  diffsel.options.add(newOption)
                  if (savediff == diff){
                     document.getElementById('diffchoice').value = savediff
                     finddiff = true
                  }
         }
      }
      if (!finddiff)
         document.getElementById('diffchoice').value = 'expert'
      return 
   }

   function sortstrength(){
   	min = parseInt(document.getElementById("strength0").innerHTML)
   	minnum = 0
   	for (i = 1; i < 9; i++){
   		tmp = parseInt(document.getElementById("strength"+String(i)).innerHTML)
   		if (tmp < min){
   			min = tmp
   			minnum = i
   		}
   	}
   	document.getElementById("strength"+String(minnum)).style.color = "red"
   }
   
   
   function saveToCookie(){
   	var inputs = document.getElementsByTagName("input");
   	var selects = document.getElementsByTagName("select");
   	for (var i=0; i<inputs.length; i++){
   		if (inputs[i].type == "text")
   			setCookie(inputs[i].name+"unit", inputs[i].value, 1);
   	}
   	for (var i=0; i<selects.length; i++){
   		setCookie(selects[i].name+"unit", selects[i].value, 1);
   	}
   	setCookie("mezame"+"unit", mezame, 1)
   	setCookie("language"+"unit", language, 1)
   }
   
   function check(){
   	var inputs = document.getElementsByTagName("input");
   	for (i in inputs){
   		if ((inputs[i].type != "text") || (inputs[i].name == "songsearch"))
   			continue
   		if (!isNumber(inputs[i].value)){
   			alert("请输入数字");
   			return false;
   		}
   	}
   	saveToCookie();
      calculate()
      document.getElementById("result").scrollIntoView()
   	return true;
   }
   
   function cbmulti(cb) {
      if (cb <= 50) {
         return 1;
      } else if (cb <= 100) {
         return 1.1 - 5 / cb;
      } else if (cb <= 200) {
         return 1.15 - 10 / cb;
      } else if (cb <= 400) {
         return 1.2 - 20 / cb;
      } else if (cb <= 600) {
         return 1.25 - 40 / cb;
      } else if (cb <= 800) {
         return 1.3 - 70 / cb;
      } else {
         return 1.35 - 110 / cb;
      }
   }

   function addskill(dist, score, prob, minscore) {
      var newdist = [];
      var q = 1 - prob;
      var i = 0;
      for (; i < dist.length && dist[i][0] < minscore; i++) {
         newdist.push(dist[i]);
      }
      if (i < dist.length) {
         var j = i;
         for (;;) {
            if (dist[i][0] < dist[j][0] + score) {
               newdist.push([dist[i][0], dist[i][1] * q]);
               if (++i >= dist.length) {
                  break;
               }
            } else if (dist[i][0] > dist[j][0] + score) {
               newdist.push([dist[j][0] + score, dist[j][1] * prob]);
               ++j;
            } else {
               newdist.push([dist[i][0], dist[i][1] * q + dist[j][1] * prob]);
               ++j;
               if (++i >= dist.length) {
                  break;
               }
            }
         }
         for (; j < dist.length; j++) {
            newdist.push([dist[j][0] + score, dist[j][1] * prob]);
         }
      }
      return newdist;
   }

   function samegroup(song, card){
      if (song['muse'] == 1)
         for (i in unitgradechr[4])
            if (card['jpname'] == unitgradechr[4][i])
               return true
      if (song['aqours'] == 1)
         for (i in unitgradechr[5])
            if (card['jpname'] == unitgradechr[5][i])
               return true
      return false
   }

   function strengthdetail(i){
    tail = tail || 0
    basic = 0
    if (c.support == 1)
      return 0
    if (c.Cskillpercentage < 12){
      if (mezame == 0)
        basic = parseInt(c[c.attribute]*1.09)+kizuna[c.rarity][0]
      else
        basic = parseInt(c[c.attribute+'2']*1.09)+kizuna[c.rarity][1]
    }
    else{
      if (mezame == 0)
        basic = parseInt(c[c.attribute])+parseInt(c[c.Cskillattribute]*0.12)+kizuna[c.rarity][0]
      else
        basic = parseInt(c[c.attribute+'2'])+parseInt(c[c.Cskillattribute+'2']*0.12)+kizuna[c.rarity][1]
    }
    if (!c.skill)
      return basic
    skill = 0
    if (c.skilleffect == 11)
      skill = skillstrength(c, level, combo, longrate, perfectrate, time, starperfect)
    return basic+skill
   }

   function calculate() {
      var result = {};
      var int_element = ["cardid", "smile", "pure", "cool", "skilllevel", 'gemnum', 'gemskill', 'gemacc'];
      var float_element = ["weight",'gemsinglepercent','gemallpercent'];
      var sel_element = ['base', 'base2', 'bonus', 'bonus2', 'map'];
      var sel_int = ['percentage', 'percentage2', 'secondlimit', 'secondlimit2', 'secondpercentage', 'secondpercentage2', 'combo', 'perfect', 'starperfect', 'time', 'skillup', 'tapup'];
      var sel_float = [];
      var atts = ['smile', 'pure', 'cool'];
      var member = [{}, {}, {}, {}, {}, {}, {}, {}, {}];
      var mapcenter = {};
      result['baseatt'] = {};
      result['bonusatt'] = {};
      mapcenter['secondbase'] = document.getElementById('map').value
      mapcenter['secondbase2'] = document.getElementById('map').value
      for (var i = 0; i < atts.length; i++) {
         result['baseatt'][atts[i]] = 0;
         result['bonusatt'][atts[i]] = 0;
      }
      for (var i = 0; i < sel_int.length; i++) {
         mapcenter[sel_int[i]] = parseInt(document.getElementById(sel_int[i]).value);
      }
      for (var i = 0; i < sel_float.length; i++) {
         mapcenter[sel_float[i]] = parseFloat(document.getElementById(sel_float[i]).value);
      }
      for (var i = 0; i < sel_element.length; i++) {
         mapcenter[sel_element[i]] = document.getElementById(sel_element[i]).value;
      }
      for (var i = 0; i < 9; i++) {
         for (var j = 0; j < int_element.length; j++) {
            member[i][int_element[j]] = parseInt(document.getElementById(int_element[j] + i.toString()).value);
         }
         for (var j = 0; j < float_element.length; j++) {
            member[i][float_element[j]] = parseFloat(document.getElementById(float_element[j] + i.toString()).value);
         }
         member[i]["main"] = document.getElementById("main" + i.toString()).value;
         member[i]["skill"] = cardtoskilltype(cards[member[i]["cardid"]])
         member[i]["require"] = cards[member[i]["cardid"]]['skilldetail'][member[i]['skilllevel']-1].require
         member[i]["possibility"] = cards[member[i]["cardid"]]['skilldetail'][member[i]['skilllevel']-1].possibility
         member[i]["score"] = cards[member[i]["cardid"]]['skilldetail'][member[i]['skilllevel']-1].score
         sk = member[i]["skill"]
         if ((sk == 1) || (sk == 2) || (sk == 3) || (sk == 4) || (sk == 11)|| (sk == 10)){
            member[i]["score"] *= (1+1.5*parseInt(member[i]['gemskill']))
            member[i]["score"] = Math.ceil(member[i]["score"])
         }
         for (var j = 0; j < atts.length; j++) {
            result['baseatt'][atts[j]] += member[i][atts[j]];
         }
      }

      mainatt = mapcenter['map']
      rawmainatt = result['baseatt'][mainatt]

      rawmember = [0,0,0,0,0,0,0,0,0]
      attst = [0,0,0,0,0,0,0,0,0]
      for (var i = 0; i < 9; i++) {
         tmp = new Array()
         tmp['smile'] = member[i]['smile']
         tmp['pure'] = member[i]['pure']
         tmp['cool'] = member[i]['cool']
         rawmember[i] = tmp
         attst[i] = member[i][mainatt]
      }
      totalall = 0
      //数值和单体百分比宝石
      for (var i = 0; i < 9; i++) {
         origin = member[i][mainatt]
         member[i][mainatt] += member[i]["gemnum"]
         attst[i] += member[i]["gemnum"]
         if (member[i]["gemsinglepercent"] > 0.2){
            member[i][mainatt] += Math.ceil(0.1*origin)+Math.ceil(0.16*origin)
            attst[i] += Math.ceil(0.1*origin)+Math.ceil(0.16*origin)
         }
         else {
            member[i][mainatt] += Math.ceil(member[i]["gemsinglepercent"]*origin)
            attst[i] += Math.ceil(member[i]["gemsinglepercent"]*origin)
         }
         
      }
      //i带全体宝石，给j加
      teamgem = new Array()
      for (var i = 0; i < 9; i++) {
         teamgem[i] = [0,0,0,0,0,0,0,0,0]
         for (var j = 0;j < 9;j ++){
            if (member[i]["gemallpercent"] > 0.04){
               member[j][mainatt] += Math.ceil(0.018*rawmember[j][mainatt])+Math.ceil(0.024*rawmember[j][mainatt])
               totalall += Math.ceil(0.018*rawmember[j][mainatt])+Math.ceil(0.024*rawmember[j][mainatt])
               teamgem[i][j] = Math.ceil(0.018*rawmember[j][mainatt])+Math.ceil(0.024*rawmember[j][mainatt])
               attst[j] += Math.ceil(0.018*rawmember[j][mainatt])+Math.ceil(0.024*rawmember[j][mainatt])
            }
            else{
               member[j][mainatt] += Math.ceil(member[i]["gemallpercent"]*rawmember[j][mainatt])
               totalall += Math.ceil(member[i]["gemallpercent"]*rawmember[j][mainatt])
               teamgem[i][j] = Math.ceil(member[i]["gemallpercent"]*rawmember[j][mainatt])
               attst[j] += Math.ceil(member[i]["gemallpercent"]*rawmember[j][mainatt])
            }
         }
      }

      rawattst = attst.concat()
      rawteamgem= new Array()
      
      result['baseatt'][mainatt] = 0
      for (var i = 0; i < 9; i++) {
         rawteamgem[i] = teamgem[i].concat()
         result['baseatt'][mainatt] += member[i][mainatt];
      }
      //主c技能
      for (var i = 0; i < 9; i++) {
         result['bonusatt'][mapcenter['bonus']] += Math.ceil(mapcenter['percentage']*member[i][mapcenter['base']]/100);
         if (mapcenter['base'] == mainatt){
            attst[i] += Math.ceil(rawattst[i]*mapcenter['percentage']/100)
            for (var j = 0; j < 9; j++)
               teamgem[j][i] += Math.ceil(rawteamgem[j][i]*mapcenter['percentage']/100)
         }
         else
            attst[i] += Math.ceil(member[i][mapcenter['base']]*mapcenter['percentage']/100)
      }
      //副c技能
      for (var i = 0; i < 9; i++) {
         if (isinunitgroup(mapcenter['secondlimit'], cards[member[i]["cardid"]]["jpname"])){
            result['bonusatt'][mapcenter['secondbase']] += Math.ceil(member[i][mapcenter['secondbase']]*mapcenter['secondpercentage']/100)
            attst[i] += Math.ceil(rawattst[i]*mapcenter['secondpercentage']/100)
            for (var j = 0; j < 9; j++)
               teamgem[j][i] += Math.ceil(rawteamgem[j][i]*mapcenter['secondpercentage']/100)
         }

      }
      //好友主c技能
      for (var i = 0; i < 9; i++) {
         result['bonusatt'][mapcenter['bonus2']] += Math.ceil(mapcenter['percentage2']*member[i][mapcenter['base2']]/100);
         if (mapcenter['base2'] == mainatt){
            attst[i] += Math.ceil(rawattst[i]*mapcenter['percentage2']/100)
            for (var j = 0; j < 9; j++)
               teamgem[j][i] += Math.ceil(rawteamgem[j][i]*mapcenter['percentage2']/100)
         }
         else
            attst[i] += Math.ceil(member[i][mapcenter['base2']]*mapcenter['percentage2']/100)
      }
      //好友副c技能
      for (var i = 0; i < 9; i++) {
         if (isinunitgroup(mapcenter['secondlimit2'], cards[member[i]["cardid"]]["jpname"])){
            result['bonusatt'][mapcenter['secondbase2']] += Math.ceil(member[i][mapcenter['secondbase2']]*mapcenter['secondpercentage2']/100)
            attst[i] += Math.ceil(rawattst[i]*mapcenter['secondpercentage2']/100)
            for (var j = 0; j < 9; j++)
               teamgem[j][i] += Math.ceil(rawteamgem[j][i]*mapcenter['secondpercentage2']/100)
         }
      }

      document.getElementById('resultsmile').innerHTML = (result.baseatt.smile+result.bonusatt.smile).toString()+" (+"+result.bonusatt.smile.toString()+")"
      document.getElementById('resultpure').innerHTML = (result.baseatt.pure+result.bonusatt.pure).toString()+" (+"+result.bonusatt.pure.toString()+")"
      document.getElementById('resultcool').innerHTML = (result.baseatt.cool+result.bonusatt.cool).toString()+" (+"+result.bonusatt.cool.toString()+")"


      var showatt = result['bonusatt'][mapcenter['map']]+result['baseatt'][mapcenter['map']];
      var combomulti = cbmulti(mapcenter['combo']);
      var accmulti = 0.88+0.12*(mapcenter['perfect']/mapcenter['combo']);
      var trueatt = showatt

      totalattst = 0
      totalweight = 0
      for (var i = 0; i < 9; i++) {
         totalweight += member[i]['weight']
         for (var j = 0; j < 9; j++){
            attst[i] += teamgem[i][j]
            attst[j] -= teamgem[i][j]
         }
      }
      rawattst = attst.concat()
      totalrawst = 0
      for (var i = 0; i < 9; i++) {
         totalrawst += rawattst[i]
         groupbonus = samegroup(songs[document.getElementById('songchoice').value],cards[member[i]["cardid"]])
         colorbonus = (mapcenter['map'] == member[i]['main'])
         if (!groupbonus && !colorbonus)
            attst[i] -= Math.round(showatt*member[i]['weight']/totalweight*0.21/1.21)
         else if (!groupbonus || !colorbonus)
            attst[i] -= Math.round(showatt*member[i]['weight']/totalweight*0.1/1.1)
         document.getElementById('attstrength'+String(i)).innerHTML = attst[i].toString()
         totalattst += attst[i]
      }
      
      result['accuracy'] = 0;
      var averageaccuracy = [0,0,0,0,0,0,0,0,0]
      for (var i = 0; i < 9; i++) {
         var skill = member[i]['skill'];
         if (skill == 5) {
            skillc = member[i]['score']*member[i]['possibility']/100/member[i]['require']
            skillc = skillc/(skillc+1.0)
            waste = (1-skillc)*skillc*member[i]['require']/2+skillc*member[i]['score']/2
            skillc = (skillc*mapcenter['time']-waste)/mapcenter['time']
            skillc = parseInt(1000*skillc)/10
            averageaccuracy[i] = skillc
         } else if (skill == 6 || skill == 12) {
            skillc = mapcenter['combo']*member[i]['score']*member[i]['possibility']/100/member[i]['require']/mapcenter['time']
            waste = skillc*member[i]['score']/2
            skillc = mapcenter['combo']*member[i]['score']*member[i]['possibility']/100/member[i]['require']/mapcenter['time']*(mapcenter['combo']-member[i]['require']/2)/mapcenter['combo']
            skillc = (skillc*mapcenter['time']-waste)/mapcenter['time']
            skillc = parseInt(1000*skillc)/10
            averageaccuracy[i] = skillc
         }
      }
      totalaccuracy = 0
      for (var i = 0; i < 9; i++) {
         totalaccuracy += (1-totalaccuracy)*(averageaccuracy[i]/100)  
      }
      /*
      for (var i = 0; i < 9; i++) {
         if (member[i]['gemacc'] == "1"){
            member[i][mainatt]*= (1+0.25*totalaccuracy)
            member[i][mainatt] = parseInt(member[i][mainatt])
            showatt += parseInt(member[i][mainatt]*0.25*totalaccuracy)
         }
      }
      */
      result['minscore'] = 0;
      for (var i = 0; i < 9; i++) {
         //result['minscore'] += Math.floor(showatt/80*member[i]['weight']*combomulti*accmulti*(mapcenter['map'] === member[i]['main'] ? 1.1 : 1)*(samegroup(songs[document.getElementById('songchoice').value],cards[member[i]["cardid"]]) ? 1.1 : 1));
      }
      result['minscore'] = 1.21*totalattst/80*totalweight*combomulti*accmulti*(1+mapcenter['tapup']/100)
      
      result['maxscore'] = result['minscore'];
      result['averagescore'] = result['minscore'];
      result['averageheal'] = 0;
      result['maxheal'] = 0;
      
      var skillchance = [0, 0, 0, 0, 0, 0, 0, 0, 0];
      var averageskillscore = [0, 0, 0, 0, 0, 0, 0, 0, 0];
      var averageheal = [0,0,0,0,0,0,0,0,0]
      

      for (var i = 0; i < 9; i++) {
         var skill = member[i]['skill'];
         member[i]['possibility'] *= (1+mapcenter['skillup']/100)
         if (skill == 1 || skill == 11) {
            skillchance[i] = Math.floor(mapcenter['combo']/member[i]['require']);
            result['maxscore'] += skillchance[i]*member[i]['score'];
            averageskillscore[i] = skillchance[i]*member[i]['possibility']*member[i]['score']/100;
            result['averagescore'] += skillchance[i]*member[i]['possibility']*member[i]['score']/100;
         } else if (skill == 2) {
            skillchance[i] = Math.floor(mapcenter['perfect']/member[i]['require']);
            result['maxscore'] += skillchance[i]*member[i]['score'];
            averageskillscore[i] = skillchance[i]*member[i]['possibility']*member[i]['score']/100;
            result['averagescore'] += skillchance[i]*member[i]['possibility']*member[i]['score']/100;
         } else if (skill == 4) {
            skillchance[i] = Math.floor(mapcenter['time']/member[i]['require']);
            result['maxscore'] += skillchance[i]*member[i]['score'];
            averageskillscore[i] = skillchance[i]*member[i]['possibility']*member[i]['score']/100;
            result['averagescore'] += skillchance[i]*member[i]['possibility']*member[i]['score']/100;
         } else if (skill == 7 || skill == 13) {
            skillchance[i] = Math.floor(mapcenter['combo']/member[i]['require']);
            result['maxheal'] += skillchance[i]*member[i]['score'];
            averageheal[i] = skillchance[i]*member[i]['possibility']*member[i]['score']/100
            result['averageheal'] += skillchance[i]*member[i]['possibility']*member[i]['score']/100;
            if (member[i]['gemskill'] == '1'){
               member[i]["skill"] = 1
               member[i]["score"] *= naipan
               result['maxscore'] += skillchance[i]*member[i]['score'];
               averageskillscore[i] = skillchance[i]*member[i]['possibility']*member[i]['score']/100;
               result['averagescore'] += skillchance[i]*member[i]['possibility']*member[i]['score']/100;
            }
         } else if (skill == 8) {
            skillchance[i] = Math.floor(mapcenter['time']/member[i]['require']);
            result['maxheal'] += skillchance[i]*member[i]['score'];
            averageheal[i] = skillchance[i]*member[i]['possibility']*member[i]['score']/100
            result['averageheal'] += skillchance[i]*member[i]['possibility']*member[i]['score']/100;
            if (member[i]['gemskill'] == '1'){
               member[i]["skill"] = 4
               member[i]["score"] *= naipan
               result['maxscore'] += skillchance[i]*member[i]['score'];
               averageskillscore[i] = skillchance[i]*member[i]['possibility']*member[i]['score']/100;
               result['averagescore'] += skillchance[i]*member[i]['possibility']*member[i]['score']/100;
            }
         } else if (skill == 9) {
            skillchance[i] = Math.floor(mapcenter['perfect']/member[i]['require']);
            result['maxheal'] += skillchance[i]*member[i]['score'];
            averageheal[i] = skillchance[i]*member[i]['possibility']*member[i]['score']/100
            result['averageheal'] += skillchance[i]*member[i]['possibility']*member[i]['score']/100;
            if (member[i]['gemskill'] == '1'){
               member[i]["skill"] = 2
               member[i]["score"] *= naipan
               result['maxscore'] += skillchance[i]*member[i]['score'];
               averageskillscore[i] = skillchance[i]*member[i]['possibility']*member[i]['score']/100;
               result['averagescore'] += skillchance[i]*member[i]['possibility']*member[i]['score']/100;
            }
         } else if (skill == 10) {
            skillchance[i] = Math.floor(mapcenter['starperfect']/member[i]['require']);
            result['maxscore'] += skillchance[i]*member[i]['score'];
            averageskillscore[i] = skillchance[i]*member[i]['possibility']*member[i]['score']/100;
            result['averagescore'] += skillchance[i]*member[i]['possibility']*member[i]['score']/100;
         }
      }
      
      var finish = false;
      var infinite = false;
      var averagescoringtimes = [0, 0, 0, 0, 0, 0, 0, 0, 0];
      var maxscoringtimes = [0, 0, 0, 0, 0, 0, 0, 0, 0];
      while (!finish) {
         finish = true;
         if (result['averagescore'] > 10000000) {
            result['averagescore'] = '1000w+';
            infinite = true;
            break;
         }
         for (var i = 0; i < 9; i++) {
            if (member[i]['skill'] == 3 && averagescoringtimes[i] < Math.floor(result['averagescore']/member[i]['require'])) {
               remaintimes = Math.floor(result['averagescore']/member[i]['require'])-averagescoringtimes[i];
               averagescoringtimes[i] += remaintimes;
               averageskillscore[i] += remaintimes*member[i]['possibility']*member[i]['score']/100;
               result['averagescore'] += remaintimes*member[i]['possibility']*member[i]['score']/100;
               finish = false;
            }
         }
      }
      if (!infinite) {
         result['averagescore'] = Math.round(result['averagescore']);
      }
      finish = false;
      infinite = false;
      while (!finish) {
         finish = true;
         if (result['maxscore'] > 10000000) {
            result['maxscore'] = '1000w+';
            infinite = true;
            break
         }
         for (var i = 0; i < 9; i++) {
            if (member[i]['skill'] == 3 && maxscoringtimes[i] < Math.floor(result['maxscore']/member[i]['require'])) {
               remaintimes = Math.floor(result['maxscore']/member[i]['require'])-maxscoringtimes[i];
               maxscoringtimes[i] += remaintimes;
               result['maxscore'] += remaintimes*member[i]['score'];
               finish = false;
            }
         }
      }
      
      if (document.getElementById('distribution').checked){
         var t0 = window.performance.now();
         
         var percentiles = [0.01, 0.02, 0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.95, 0.98, 0.99];
         var dist = [[result['minscore'], 1]];
         for (var i = 0; i < 9; i++) {
            var skill = member[i]['skill'];
            if (skill == 1 || skill == 2 || skill == 4 || skill == 10 || skill == 11) {
               for (var j = 0; j < skillchance[i]; j++) {
                  dist = addskill(dist, member[i]['score'], member[i]['possibility'] / 100, 0);
               }
            }
         }
         
         var nextscore = [Infinity, Infinity, Infinity, Infinity, Infinity, Infinity, Infinity, Infinity, Infinity];
         for (var i = 0; i < 9; i++) {
            if (member[i]['skill'] == 3) {
               nextscore[i] = member[i]['require'];
            }
         }
         for (;;) {
            var next = 0;
            for (var i = 1; i < 9; i++) {
               if (nextscore[i] < nextscore[next]) {
                  next = i;
               }
            }
            if ((nextscore[next] > dist[dist.length - 1][0]) || (nextscore[next] > 3000000)) {
               break;
            }
            dist = addskill(dist, member[next]['score'], member[next]['possibility'] / 100, nextscore[next]);
            nextscore[next] += member[next]['require'];
         }
         
         var scores = [];
         var k = 0;
         var p = 0;
         for (var i = 0; i < dist.length && k < percentiles.length; i++) {
            p += dist[i][1];
            for (; k < percentiles.length && p >= percentiles[k]; k++) {
               scores[k] = dist[i][0];
            }
         }
         
         var t1 = window.performance.now();
         console.debug('Elapesd time (ms): ' + (t1 - t0).toFixed(3));
         console.debug('Possibilities: ' + dist.length.toString());
         var p = 0;
         for (var i = 0; i < dist.length; i++) {
            p += dist[i][1];
         }
         console.debug('Total probability (naïve summation): 1 ' + (p >= 1 ? '+ ' : '- ') + Math.abs(p - 1).toString());
         var s0 = 0, s1 = 0;
         for (var i = 0; i < dist.length; i++) {
            var s = s0 + dist[i][1];
            var bb = s - s0;
            var e = (dist[i][1] - bb) + (s0 - (s - bb)) + s1;
            s0 = s + e;
            s1 = e - (s0 - s);
         }
         var ep = (s0 - 1) + s1;
         console.debug('Total probability: 1 ' + (ep >= 0 ? '+ ' : '- ') + Math.abs(ep).toString());
         var meanscore = 0;
         for (var i = 0; i < dist.length; i++) {
            meanscore += dist[i][0] * dist[i][1];
         }
         document.getElementById('averagescore').innerHTML = meanscore.toFixed(0).toString()
         console.debug('Mean score: ' + meanscore.toString());
         
         console.debug(result);
         for (i in scores){
            document.getElementById('simresult'+(100-percentiles[i]*100).toString()).innerHTML = scores[i].toFixed(0).toString()
         }
      }
      else
         document.getElementById('averagescore').innerHTML = result['averagescore'].toString()

      document.getElementById('resultstrength').innerHTML = (result.averagescore/result.minscore*totalattst).toFixed(0).toString()
      document.getElementById('averageheal').innerHTML = result.averageheal
      console.debug(scores);
      
      ttweight = 0
      ttstrength = 0
      for (i=0;i<9;i++)
         ttweight += member[i]['weight']
      skillst = [0,0,0,0,0,0,0,0,0]
      for (i=0;i<9;i++){
         leader = 0

         skillst[i] = parseInt(Math.round(averageskillscore[i]/result.minscore*totalattst/(1+mapcenter['skillup']/100)*(1+mapcenter['tapup']/100)).toFixed(0))
      }
      for (i=0;i<9;i++){
         document.getElementById('cardstrength'+String(i)).innerHTML = (rawattst[i]+skillst[i]).toString()
         document.getElementById('strength'+String(i)).innerHTML = (attst[i]+skillst[i]).toString()
         document.getElementById('skillstrength'+String(i)).innerHTML = skillst[i].toString()
         document.getElementById('heal'+String(i)).innerHTML = averageheal[i].toString()
         ttstrength += (attst[i]+skillst[i])
      }
      document.getElementById('resultstrength').innerHTML = ttstrength.toFixed(0).toString()+' (属性 '+totalattst.toString()+' + 技能 '+(ttstrength-totalattst).toString()+')'
      minstrength = 100000000
      minwhich = -1
      mincardstrength = 100000000
      mincard = -1
      for (i=0;i<9;i++){
         document.getElementById('strength'+String(i)).style.color = ''
         document.getElementById('cardstrength'+String(i)).style.color = ''
         if (parseInt(document.getElementById('strength'+String(i)).innerHTML) < minstrength){
            minwhich = i
            minstrength = parseInt(document.getElementById('strength'+String(i)).innerHTML)
         }
         if (parseInt(document.getElementById('cardstrength'+String(i)).innerHTML) < mincardstrength){
            mincard = i
            mincardstrength = parseInt(document.getElementById('cardstrength'+String(i)).innerHTML)
         }
         trueacc = 100*(averageaccuracy[i]/100)*(1-totalaccuracy)/(1-averageaccuracy[i]/100)
         //document.getElementById('accuracy'+String(i)).innerHTML = trueacc.toFixed(1).toString()+'%<br>('+averageaccuracy[i].toString()+'%)'
      }
      //document.getElementById('averageaccuracy').innerHTML = (totalaccuracy*100).toFixed(1).toString()+'%'
      document.getElementById('result').style.display = ""
      document.getElementById('strength'+String(minwhich)).style.color = 'red'
      document.getElementById('cardstrength'+String(mincard)).style.color = 'red'
   }

   function changemapcolor(){
      document.getElementById('secondbase').innerHTML = document.getElementById('map').value
      document.getElementById('secondbase2').innerHTML = document.getElementById('map').value
      document.getElementById('base2').value = document.getElementById('map').value
      document.getElementById('bonus2').value = document.getElementById('map').value
   }

   function callback(){
   	alert('4')
   }
   </script>
  </head>
 <body onload="init()">
 <nav class="navbar navbar-default" role="navigation">
   <div class="navbar-header">
      <a class="navbar-brand" href="/">LLhelper</a>
   </div>
   <div>
      <ul class="nav navbar-nav">
         <li><a href="/">应用</a></li>
         <li class="active"><a href=#>队伍强度、得分计算</a></li>
         <li><a href="/about">关于</a></li>
      </ul>
   </div>
</nav>
<pre>
使用方法：
	1、选择歌曲 或 填写歌曲详细信息 <font style='color:red'><b>务必记得修改perfect数量</b></font>
	2、从卡牌库中选择一张卡，点击转移来放置到对应位置，没有录入的卡片数据可以手动输入 <font style='color:red'><b>一张卡默认为满级、一级技能的数据，若不是则需要修改</b></font>
	3、使用以上方法选择所有的9张卡
	4、可以点击”保存队伍“将队伍配置文件保存到本地
	5、第2、3步可以从保存的文件中读取队伍信息来代替：点击”选择文件“选择本地配置文件，再点击”读取队伍“
	6、选择主唱技能和好友主唱技能 <font style='color:red'><b>计算SM得分时将好友主唱加成设为0%</b></font>
	7、点击Calculate

当前版本：4.1及以上。</a>
</pre>
<input type="submit" name="clear" value="清空输入" onclick="clearall()"><br>
<form action="" id="unitform" name="unitform" method="POST" onsubmit="return check()" enctype=multipart/form-data>
<!--<form action="/llloadunit"  onsubmit=""  target="if">-->
<h3>歌曲信息</h3>
搜索：<input type="text" id="songsearch" name="songsearch" value="" onchange="changesongselect()"></input><br>
筛选：
	<select id="songatt" name="songatt" onchange="changesongselect()">
		<option value="">属性</option>
		<option value="smile">smile</option>
		<option value="pure">pure</option>
		<option value="cool">cool</option>
	</select><br>
歌曲：<select id="songchoice" name="songchoice" onchange="changediffinfo();changesongcolor('songchoice')">
		<option value=""> </option>
	</select>
	<input type="button" id="language" name="language" onclick="changeLanguage()" value="切换语言"></input>
	<br>
   难度：<select id="diffchoice" name="diffchoice" onchange="changesongcolor('songchoice')">
      <option value="easy">easy</option>
      <option value="normal">normal</option>
      <option value="hard">hard</option>
      <option value="expert" SELECTED>expert</option>
      <option value="master">master</option>
   </select><br>
	图属性 :<select id="map" name="map" onchange="changemapcolor();">
		<option value="smile">smile</option>
		<option value="pure">pure</option>
		<option value="cool">cool</option>
	</select><br>
	总combo数 :<input type="text" id="combo" name="combo" value="300" autocomplete="off" style="width:50px"><br>
	perfect数:<input type="text" id="perfect" name="perfect" value="285" autocomplete="off" style="width:50px"><br>
	时间:<input type="text" id="time" name="time" value="100" autocomplete="off" style="width:50px">秒（从人物出现到最后一个note被击打的时间，不是歌曲长度。部分谱面无长度数据，默认值为110秒）<br>
	星星perfect数:<input type="text" id="starperfect" name="starperfect" value="47" autocomplete="off" style="width:50px">（只有星星系加分需要填写）<br>
<br>
<h3>卡片库</h3>
筛选：<select id="rarity" name="rarity" onchange="changecardselect()">
      <option value="">稀有度</option>
      <option value="N">N</option>
      <option value="R">R</option>
      <option value="SR">SR</option>
      <option value="SSR">SSR</option>
      <option value="UR">UR</option>
   </select>
   <select id="chr" name="chr" onchange="changecardselect()">
      <option value="">角色</option>
      <option value="高坂穗乃果">高坂穗乃果</option>
      <option value="绚濑绘里">绚濑绘里</option>
      <option value="南小鸟">南小鸟</option>
      <option value="园田海未">园田海未</option>
      <option value="星空凛">星空凛</option>
      <option value="西木野真姬">西木野真姬</option>
      <option value="东条希">东条希</option>
      <option value="小泉花阳">小泉花阳</option>
      <option value="矢泽妮可">矢泽妮可</option>
      <option value="高海千歌">高海千歌</option>
      <option value="樱内梨子">樱内梨子</option>
      <option value="松浦果南">松浦果南</option>
      <option value="黑泽黛雅">黑泽黛雅</option>
      <option value="渡边曜">渡边曜</option>
      <option value="津岛善子">津岛善子</option>
      <option value="国木田花丸">国木田花丸</option>
      <option value="小原鞠莉">小原鞠莉</option>
      <option value="黑泽露比">黑泽露比</option>
   </select>
   <select id="unitgrade" name="unitgrade" onchange="changecardselect()">
      <option value="">年级小队</option>
      <option value="4">μ's</option>
      <option value="5">Aqours</option>
      <option value="1">一年级</option>
      <option value="2">二年级</option>
      <option value="3">三年级</option>
      <option value="6">Printemps</option>
      <option value="7">lilywhite</option>
      <option value="8">BiBi</option>
      <option value="9">CYaRon!</option>
      <option value="10">AZALEA</option>
      <option value="11">Guilty Kiss</option>
   </select>
   <select id="att" name="att" onchange="changecardselect()">
      <option value="">属性</option>
      <option value="smile" style="color:red">smile</option>
      <option value="pure" style="color:green">pure</option>
      <option value="cool" style="color:blue">cool</option>
   </select>
   <select id="triggertype" name="triggertype" onchange="changecardselect()">
      <option value="">触发类型</option>
      <option value="1">时间</option>
      <option value="3">图标</option>
      <option value="4">combo</option>
      <option value="5">分数</option>
      <option value="6">perfect</option>
      <option value="12">星星perfect</option>
   </select>
   <select id="skilltype" name="skilltype" onchange="changecardselect()">
      <option value="">技能类型</option>
      <option value="4">小判定</option>
      <option value="5">大判定</option>
      <option value="9">回血</option>
      <option value="11">加分</option>
   </select>
   <select id="cardtype" name="cardtype" onchange="changecardselect()">
      <option value="">卡片类型</option>
      <option value="活动卡">活动卡</option>
      <option value="登录奖励">登录奖励</option>
   </select>
   <select id="special" name="special" onchange="changecardselect()">
      <option value="">是否特典卡</option>
      <option value=0>不是特典</option>
      <option value=1>是特典</option>
   </select>
   <select id="setname" name="setname" onchange="changecardselect()">
      <option value="">套卡名</option>
      <option value="初期">初期</option>
      <option value="職業編">职业篇</option>
      <option value="動物編">动物篇</option>
      <option value="8月編">8月篇</option>
      <option value="9月編">9月篇</option>
      <option value="10月編">10月篇</option>
      <option value="11月編">11月篇</option>
      <option value="12月編">12月篇</option>
      <option value="1月編">1月篇</option>
      <option value="2月編">2月篇</option>
      <option value="3月編">3月篇</option>
      <option value="4月編">4月篇</option>
      <option value="5月編">5月篇</option>
      <option value="6月編">6月篇</option>
      <option value="7月編">7月篇</option>
      <option value="チャイナドレス編">旗袍篇</option>
      <option value="カフェメイド編">女仆篇</option>
      <option value="ハロウィン編">万圣篇</option>
      <option value="星座編">星座篇</option>
      <option value="雪山編">雪山篇</option>
      <option value="七福神編">七福神篇</option>
      <option value="バレンタイン編">情人节篇</option>
      <option value="ホワイトデー編">白色情人节篇</option>
      <option value="職業編(Part2">职业篇2</option>
      <option value="サイバー編">电玩篇</option>
      <option value="手品師編">魔术师篇</option>
      <option value="マリン編">海兵篇</option>
      <option value="プール編">泳池篇</option>
      <option value="くのいち編">忍者篇</option>
      <option value="動物編(Part2)">动物篇2</option>
      <option value="舞踏会編">舞踏会篇</option>
      <option value="クリスマス編">圣诞篇</option>
      <option value="サーカス編">马戏团篇</option>
      <option value="妖精の国編">妖精之国篇</option>
   </select>
   <input type="checkbox" id="showncard" name="showncard" onchange="changecardselect()">显示N卡</input>
   <br>
卡片：<select id="cardchoice" name="cardchoice" onchange="skilllevel = 0;changeskilllevel();changecolor('cardchoice')">
		<option value=""> </option>
	</select>
	<input type="checkbox" id="mezame" name="mezame" onclick="toMezame()">觉醒</input><input type="button" id="language" name="language" onclick="changeLanguage()" value="切换语言"></input>
	（特典卡需选择觉醒）<br>
<div style="float:left">
	裸smile :<input type="text" id="smile" name="smile" value="0" autocomplete="off" style="color:red"></input><br>
	裸pure :<input type="text" id="pure" name="pure" value="0" autocomplete="off" style="color:green"><br>
	裸cool :<input type="text" id="cool" name="cool" value="0" autocomplete="off" style="color:blue"><br>
	主属性 :<select id="main" name="main">
		<option value="smile" style="color:red">smile</option>
		<option value="pure" style="color:green">pure</option>
		<option value="cool" style="color:blue">cool</option>
	</select><br>
	绊:<input type="text" id="kizuna" name="kizuna" value="0" autocomplete="off" ><br>
   </div>

</div>
   <div style="float:left">
<img id="imageselect">
</div>
<div style="clear:both">
   <!--
	技能 :<select id="skill" name="skill">
		<option value=0>无</option>
		<option value=1>图标系加分</option>
		<option value=2>perfect系加分</option>
		<option value=3>分数系加分</option>
		<option value=4>时间系加分</option>
		<option value=5>时间系判定</option>
		<option value=6>图标系判定</option>
		<option value=7>图标系回血</option>
		<option value=8>时间系回血</option>
		<option value=9>perfect系回血</option>
		<option value=10>星星perfect系加分</option>
		<option value=11>combo系加分</option>
		<option value=12>combo系判定</option>
		<option value=13>combo系回血</option>
	</select><br><nobr>-->
	
	<p id="skilltext" style="display:none">
   
   技能等级 : <input type="button" style="height:20px;width:20px;padding:0" value="▲" onclick="lvlup()"></input> Lv<nospan id="skilllevel">1</nospan> <input type="button" style="height:20px;width:20px;padding:0" value="▼" onclick="lvldown()"></input></nobr>
   </input></nobr><br>
   技能效果 :每<nobr id="require" name="require"></nobr>
   <nobr id="requiretext"></nobr>
   <nobr id="possibility" name="possibility"></nobr>%概率
   <nobr id="effecttext"></nobr>
   <nobr id="score" name="score"></nobr>
   <nobr id="unittext"></nobr>
   </nobr><br><br>
	</p>
<br><br>

<h3>队伍属性</h3>
<div>
<div style="float:left">
<table border='1'>
   <tr>
      <td>权重</td>
      {% for i in range(0,9) %}
      <td><input type="text" id="weight{{i}}" name="weight{{i}}" size=2 autocomplete="off"></td>
      {% endfor %}
   </tr>
   <tr>
      <td></td>
      {% for i in range(0,9) %}
      <td><input type="button" value="放卡{{i+1}}" onclick="copyTo({{i}})"></td>
      {% endfor %}
   </tr>
   <tr>
      <td>卡片</td>
   	<td ><img  id='avatar0' src='/static/null.png'/></td>
   	<td><img  id='avatar1' src='/static/null.png'/></td>
   	<td><img  id='avatar2' src='/static/null.png'/></td>
   	<td><img  id='avatar3' src='/static/null.png'/></td>
   	<td><img  id='avatar4' src='/static/null.png'/></td>
   	<td><img  id='avatar5' src='/static/null.png'/></td>
   	<td><img  id='avatar6' src='/static/null.png'/></td>
   	<td><img  id='avatar7' src='/static/null.png'/></td>
   	<td><img  id='avatar8' src='/static/null.png'/></td>
   </tr>
   <tr style="display:none">
      <td>id</td>
      {% for i in range(0,9) %}
      <td><input type="text" id="cardid{{i}}" name="cardid{{i}}" size=1 value=0 autocomplete="off"></td>
      {% endfor %}
   </tr>
   <tr style="display:none">
      <td>mezame</td>
      {% for i in range(0,9) %}
      <td><input type="text" id="mezame{{i}}" name="mezame{{i}}" size=1 value=0 autocomplete="off"></td>
      {% endfor %}
   </tr>
   <tr>
      <td>主属性</td>
      {% for i in range(0,9) %}
      <td><select id="main{{i}}" name="main{{i}}">
         <option value="smile" style="color:red">smile</option>
         <option value="pure" style="color:green">pure</option>
         <option value="cool" style="color:blue">cool</option>
      </select></td>
      {% endfor %}
   </tr>
   <tr>
      <td style="color:red">smile</td>
      {% for i in range(0,9) %}
      <td><input type="text" style="color:red" id="smile{{i}}" name="smile{{i}}" size=3 autocomplete="off"></td>
      {% endfor %}
   </tr>
   <tr>
      <td style="color:green">pure</td>
      {% for i in range(0,9) %}
      <td><input type="text" style="color:green" id="pure{{i}}" name="pure{{i}}" size=3 autocomplete="off"></td>
      {% endfor %}
   </tr>
   <tr>
      <td style="color:blue">cool</td>
      {% for i in range(0,9) %}
      <td><input type="text" style="color:blue" id="cool{{i}}" name="cool{{i}}" size=3 autocomplete="off"></td>
      {% endfor %}
	</tr>
	<tr>
      <td>总槽数</td>
      {% for i in range(0,9) %}
      <td>Lv<input type="text" id="maxcost{{i}}" name="maxcost{{i}}" value="1" autocomplete="off" size=1 style="width:20px" onchange="changeunitmaxcost({{i}})"></td>
      {% endfor %}
   </tr>
   <tr>
      <td>技能</td>
      {% for i in range(0,9) %}
      <td>Lv<input type="text" id="skilllevel{{i}}" name="skilllevel{{i}}" value="1" autocomplete="off" size=1 style="width:20px" onchange="changeunitskilllevel({{i}})"></td>
      {% endfor %}
   </tr>
   <tr>
      <td>单体数值</td>
      {% for i in range(0,9) %}
      <td><select id="gemnum{{i}}" name="gemnum{{i}}" onchange="calslot({{i}})">
         <option value="0" >0</option>
         <option value="200" >200</option>
         <option value="450" >450</option>
         <option value="650" >650</option>
      </select></td>
      {% endfor %}
   </tr>
   <tr>
      <td>单体百分比</td>
      {% for i in range(0,9) %}
      <td><select id="gemsinglepercent{{i}}" name="gemsinglepercent{{i}}" onchange="calslot({{i}})">
         <option value="0" >0</option>
         <option value="0.1" >10%</option>
         <option value="0.16" >16%</option>
         <option value="0.26" >26%</option>
      </select></td>
      {% endfor %}
   </tr>
   <tr>
      <td>全体百分比</td>
      {% for i in range(0,9) %}
      <td><select id="gemallpercent{{i}}" name="gemallpercent{{i}}" onchange="calslot({{i}})">
         <option value="0" >0</option>
         <option value="0.018" >1.8%</option>
         <option value="0.024" >2.4%</option>
         <option value="0.042" >4.2%</option>
      </select></td>
      {% endfor %}
   </tr>
   <tr>
      <td>奶/分宝石</td>
      {% for i in range(0,9) %}
      <td><select id="gemskill{{i}}" name="gemskill{{i}}" onchange="calslot({{i}})">
         <option value="0" >无</option>
         <option value="1" >有</option>
      </select></td>
      {% endfor %}
   </tr>
   <tr style="display:none">
      <td>判定宝石</td>
      {% for i in range(0,9) %}
      <td><select id="gemacc{{i}}" name="gemacc{{i}}" onchange="calslot({{i}})">
         <option value="0" >无</option>
         <option value="1" >有</option>
      </select></td>
      {% endfor %}
   </tr>
   <tr>
      <td>使用槽数</td>
      {% for i in range(0,9) %}
      <td id="slot{{i}}" name="slot{{i}}"></td>
      {% endfor %}
   </tr>
   <tr>
      <td></td>
      {% for i in range(0,9) %}
      <td><input type="button" id="pos{{i}}" name="pos{{i}}" value="换位{{i+1}}" onclick="changepos({{i}})"></td>
      {% endfor %}
   </tr>
   <tr>
      <td>属性强度</td>
      {% for i in range(0,9) %}
      <td id="attstrength{{i}}"></td>
      {% endfor %}
   </tr>
   <tr>
      <td>技能强度</td>
      {% for i in range(0,9) %}
      <td id="skillstrength{{i}}"></td>
      {% endfor %}
   </tr>
   <tr>
      <td>卡强度</td>
      {% for i in range(0,9) %}
      <td id="cardstrength{{i}}"></td>
      {% endfor %}
   </tr>
   <tr>
      <td>实际强度</td>
      {% for i in range(0,9) %}
      <td id="strength{{i}}"></td>
      {% endfor %}
   </tr>
   <!--
   <tr>
      <td>判定</td>
      {% for i in range(0,9) %}
      <td id="accuracy{{i}}"></td>
      {% endfor %}
   </tr>
-->
   <tr>
      <td>回复</td>
      {% for i in range(0,9) %}
      <td id="heal{{i}}"></td>
      {% endfor %}
   </tr>
</table>
</div>
<div style="float:left">

<input type="button" value="保存队伍" onclick="saveunit()">
<input type="file" name="file"/>
<input type="submit" value="读取队伍" onclick="loadunit()">
<br><br><br>
<div id="sisreserves">
</div>
</div>
</div>
<div style="clear:both">
</div>

主唱技能 :<select id="bonus" name="bonus">
		<option value="smile" style="color:red">smile</option>
		<option value="pure" style="color:green">pure</option>
		<option value="cool" style="color:blue">cool</option>
	</select>增加<select id="base" name="base">
      <option value="smile" style="color:red">smile</option>
      <option value="pure" style="color:green">pure</option>
      <option value="cool" style="color:blue">cool</option>
   </select>的<select id="percentage" name="percentage">
      <option value=0>0</option>
      <option value=3>3</option>
      <option value=6 SELECTED>6</option>
      <option value=7>7</option>
      <option value=9>9</option>
      <option value=12>12</option>
   </select>%+
   <select id="secondlimit" name="secondlimit">
      <option value=""></option>
      <option value="4" SELECTED>μ's</option>
      <option value="5">Aqours</option>
      <option value="1">一年级</option>
      <option value="2">二年级</option>
      <option value="3">三年级</option>
      <option value="6">Printemps</option>
      <option value="7">lilywhite</option>
      <option value="8">BiBi</option>
      <option value="9">CYaRon!</option>
      <option value="10">AZALEA</option>
      <option value="11">Guilty Kiss</option>
   </select>的<nospan id="secondbase" name="secondbase">
   歌曲属性
   <!--
      <option value="smile" style="color:red">smile</option>
      <option value="pure" style="color:green">pure</option>
      <option value="cool" style="color:blue">cool</option>-->
   </nospan>增加<select id="secondpercentage" name="secondpercentage">
      <option value=0 SELECTED>0</option>
      <option value=1>1</option>
      <option value=2>2</option>
      <option value=3>3</option>
      <option value=6>6</option>
   </select>%<br>
好友主唱技能 :<select id="bonus2" name="bonus2">
		<option value="smile" style="color:red">smile</option>
      <option value="pure" style="color:green">pure</option>
      <option value="cool" style="color:blue">cool</option>
	</select>增加<select id="base2" name="base2">
      <option value="smile" style="color:red">smile</option>
      <option value="pure" style="color:green">pure</option>
      <option value="cool" style="color:blue">cool</option>
   </select>的<select id="percentage2" name="percentage2">
      <option value=0 SELECTED>0</option>
      <option value=3>3</option>
      <option value=6>6</option>
      <option value=7>7</option>
      <option value=9>9</option>
      <option value=12>12</option>
   </select>%+
   <select id="secondlimit2" name="secondlimit2">
      <option value=""></option>
      <option value="4" SELECTED>μ's</option>
      <option value="5">Aqours</option>
      <option value="1">一年级</option>
      <option value="2">二年级</option>
      <option value="3">三年级</option>
      <option value="6">Printemps</option>
      <option value="7">lilywhite</option>
      <option value="8">BiBi</option>
      <option value="9">CYaRon!</option>
      <option value="10">AZALEA</option>
      <option value="11">Guilty Kiss</option>
   </select>的<nospan id="secondbase2" name="secondbase2">
   歌曲属性
   <!--
      <option value="smile" style="color:red">smile</option>
      <option value="pure" style="color:green">pure</option>
      <option value="cool" style="color:blue">cool</option>-->
   </nospan>增加<select id="secondpercentage2" name="secondpercentage2">
      <option value=0 SELECTED>0</option>
      <option value=1>1</option>
      <option value=2>2</option>
      <option value=3>3</option>
      <option value=6>6</option>
   </select>%<br>
点击得分增加：<input id="tapup" name="tapup" value="0" size=2></input>%<br>
技能发动率增加：<input id="skillup" name="skillup" value="0" size=2></input>%<br>
<input type="button" value="calculate" onclick="check()"> <input type="checkbox" id="distribution" name="distribution">计算分布</input>
<input type="checkbox" id="autoarm0" name="autoarm0" onclick="autoarm()">自动配饰<!--<input type="checkbox" id="naipan" name="naipan" onchange="changenaipan()">弱奶判宝石</input>-->
   <br><br><br>
</form>

<iframe style="display:none" id='if' name='if' src='about:blank' frameborder='0' allowtransparency="yes"></iframe>

<pre>
注意：
   勾选“计算分布”来计算得分分布。得分分布使用真实分布计算，计算速度比较慢。
   由于使用歌曲信息计算，最终结果可能会有千分之一的误差
   判定覆盖率仅供参考
   判定期间属性1.25倍的宝石计算有误，暂时按无效计算。
说明：   
   1、在卡片数据行中的判定指的该卡片的边际判定覆盖率影响，即撤掉这张卡后边际覆盖率的损失。在括号中的覆盖率为单卡判定覆盖率
   2、卡强度指的是不考虑异色和异团带来的负面影响时的强度，该数值方便异团卡、异色横向比较。实际强度则是考虑异色和异团加成的强度
</pre>

<div id="result" style="display:none">
<table border="1">
<tr>
	<td>smile</td>
	<td>pure</td>
	<td>cool</td>
</tr>
<tr>
	<td id="resultsmile"></td>
	<td id="resultpure"></td>
	<td id="resultcool"></td>
</tr>
</table>
卡组强度:<nospan id="resultstrength"></nospan><br>
期望得分:<nospan id="averagescore"></nospan><br>

期望回复:<nospan id="averageheal"></nospan><br>

<!--期望判定覆盖率：<nospan id="averageaccuracy"></nospan><br>-->

<h3>得分分布</h3>
<table border="1">
<tr>
	<td>1%</td>
	<td>2%</td>
	<td>5%</td>
	<td>10%</td>
	<td>20%</td>
	<td>30%</td>
	<td>40%</td>
	<td>50%</td>
	<td>60%</td>
	<td>70%</td>
	<td>80%</td>
	<td>90%</td>
	<td>95%</td>
	<td>98%</td>
	<td>99%</td>
</tr>
<tr>
	<td id='simresult1'></td>
   <td id='simresult2'></td>
   <td id='simresult5'></td>
   <td id='simresult10'></td>
   <td id='simresult20'></td>
   <td id='simresult30'></td>
   <td id='simresult40'></td>
   <td id='simresult50'></td>
   <td id='simresult60'></td>
   <td id='simresult70'></td>
   <td id='simresult80'></td>
   <td id='simresult90'></td>
   <td id='simresult95'></td>
   <td id='simresult98'></td>
   <td id='simresult99'></td>
</tr>
</div>

</body>
{% include 'footer.html' %}
</html>
