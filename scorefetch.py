# -*- coding: utf-8 -*-
import urllib2
import json
import re
import string

eventtype = ['classic', 'score match', 'medley festival']
character = ['honoka', 'kotori', 'umi', 'nozomi', 'eli', 'nico', 'rin', 'hanayo', 'maki']
last = [0,1,2,3,4,5,6,7,8,
        [[68534,69499,70409,72298],[49616,50181,50795,52138]],10,
        [[69436,70723,72131,74520],[46497,47007,47551,48836]],
        [[20119,20330,20610,21267],[14761,14980,15255,15881]],
        [[53685,54145,54805,56416],[42198,42727,43256,44523]],
        [[27612,28131,28720,30009],[18810,19179,19618,20468]],
        [[60478,61188,62022,63467],[46927,47495,48204,49605]],
        [[29432,30005,30570,31531],[21187,21621,22258,23134]],
        [[60569,61587,62805,64436],[46971,47804,48937,50549]],
        [[24209,24480,24770,25431],[17505,17833,18258,19200]],
        [[62256,63230,64289,66206],[49429,50278,51100,53045]],
        [[30636,31033,31582,32946],[21119,21558,22154,23317]],
        [[79479,80833,82045,84599],[55852,56769,57872,60120]],
        [[22235,22422,22648,23314],[15790,16022,16263,16848]],
        [[61411,61972,62727,64352],[45345,45795,46382,47802]],
        [[21111,21407,21741,22484],[15757,16097,16418,17271]],
        [[55282,55708,56471,57962],[41924,42463,43152,44416]],
        [[25415,25771,26396,27323],[18934,19376,19989,20947]],
        [[60482,61302,61984,63433],[46243,46878,47675,48968]],
        [[29256,30028,30703,32074],[20309,20897,21632,22735]],
        [[64057,64915,66099,68044],[47698,48519,49550,51108]],
        [[25766,26031,26311,26987],[18150,18520,19059,20108]],
        [[53720,54300,54900,56472],[42041,42665,43282,44725]],
        [[20106,20269,20486,21063],[13682,13866,14090,14598]],
        [[59475,60034,60443,61952],[47954,48539,49229,50922]],
        [[22752,23037,23330,24123],[16947,17198,17482,18223]],
        [[55180,55559,55982,56931],[44845,45393,46002,47478]],
        [[24779,25061,25375,26231],[18130,18473,18856,19776]],
        [[63804,64629,65370,67699],[49983,50761,51696,53614]],
        [[23344,23649,24126,25155],[16682,17180,17643,18745]],
        [[64537,65903,67577,70122],[46714,47730,48975,50932]],
        [[85673,87046,88403,90395],[57908,58868,60356,62409]],
        [[63454,64085,64917,66832],[46229,46730,47251,48879]],
        [[21820,22140,22401,23065],[15802,16042,16305,16968]],
        [[66936,67874,68856,71137],[50871,51708,52648,54967]],
        [[20928,21146,21387,22030],[15737,15973,16236,16838]],
        [[60399,61229,62382,63815],[44472,45203,46130,47731]],
        [[92945,94496,96013,99488],[67748,68993,70322,73357]],
        [[33213,33834,34651,35817],[21231,21675,22249,23552]],
        [[59981,60659,61382,63276],[43485,43976,44548,45932]],
        [[86267,87890,89992],[56927,58180,59661]],
        [[27721,28375,29361,30776],[17656,18205,18871,19964]]
        ]


#content = urllib2.urlopen('http://www.lovelivewiki.com/w/EventCutOff').read()
#content = open('111.htm', 'r').read()
content = open('eventdata.txt','r').read()

eventdatare = re.compile('<table id="eventData" border="1" class="wikitable">[\s\S]*?</table>')
eventdata = eventdatare.findall(content)[0].decode('utf-8')

trre = re.compile('<tr>([\s\S]*?)</tr>')
trredata = trre.findall(eventdata)

print len(trredata)
print trredata[len(trredata)-1]

result = {}

for i in range(6, len(trredata)/4):
    if i == 7:
        continue
    tdre = re.compile('<td>(.*?)</td>')
    info = tdre.findall(trredata[4*i+1])
    firstrank = tdre.findall(trredata[4*i+2])
    secondrank = tdre.findall(trredata[4*i+3])
    del firstrank[0]
    del secondrank[0]
    event = {}
    event['id'] = i+3
    event['character'] = character[string.atoi(info[2])]
    event['days'] = string.atoi(info[1])
    event['type'] = eventtype[string.atoi(info[6])]
    fscore = [string.atoi(s) for s in firstrank]
    sscore = [string.atoi(s) for s in secondrank]
    event['score'] = [fscore,sscore]
    if len(last)-3 > i:
        if type(last[event['id']]) != int:
            if len(sscore) == 2*event['days']:
                for j in last[event['id']][0]:
                    event['score'][0].insert(-1, j)
                for j in last[event['id']][1]:
                    event['score'][1].insert(-1, j)
            else:
                for j in last[event['id']][0]:
                    event['score'][0].append(j)
                for j in last[event['id']][1]:
                    event['score'][1].append(j)
    result[event['id']] = event
    if i == 36:
        event['score'][0]= [i-1626 for i in event['score'][0]]
        event['score'][1]= [i-1077 for i in event['score'][1]]
    print i,event

output = open('score.txt', 'wb')
output.write(json.dumps(result))
output.close()

